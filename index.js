require('dotenv').config();
const token = process.env.SECRET_CODE,
      chatId = process.env.CHAT_ID,
      providerToken = process.env.PROVIDER_TOKEN;
const src = "./docs/bot.pdf",
      { Telegraf, Markup } = require('telegraf'),
      text = require('./const'),
      bot = new Telegraf(token),
      fs =  require("fs"),
      b1 = "./docs/B1.pdf",
      b2 = "./docs/B2.pdf",
      c1 = "./docs/C1.pdf";
let levelAnswer = "",
    countDays = 0;

timeInterval = setInterval(check, 1000*60*10);

function check(){
    let read = fs.readFileSync("users.txt", "utf-8").toString().split('\n');
    for(let i = 0; i < read.length; i++){
        if(read[i] != ""){
            let string = read[i].split(' --- '),
                dateList = string[2].split('/'),
                nowNoSplit = new Date().toLocaleDateString(),
                now = nowNoSplit.split('/');
            console.log(dateList[0] + "---", now[0])
            console.log(string[2] == nowNoSplit, +dateList[0] < +now[0], +dateList[1] < +now[1])
            console.log(dateList[0], now[0], dateList[1],  now[1])
            if(string[2] == nowNoSplit || +dateList[0] < +now[0] || +dateList[1] < +now[1] || +dateList[2] < +now[2]){
                bot.telegram.sendMessage(+string[1], "–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ø–æ–¥–ø–∏—Å–∫–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –∞–Ω–≥–ª–∏–π—Å–∫–∏–º.");
                bot.telegram.sendMessage(chatId, `–ò—Ä–∏–Ω–∞, –ø—Ä–∏–≤–µ—Ç, —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @${string[0]} (${string[3]}) –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ø–æ–¥–ø–∏—Å–∫–∞.`);
                read[i] = ""
            }
        }
    }
    fs.writeFileSync("users.txt", "")
    for(let i = 0; i < read.length - 1; i++){
        if(read[i] != ""){
            fs.appendFile("users.txt", `${read[i]}\n`, function(error){
                if(error) throw error; // –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞
                             
                console.log("–ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:")
                let data = fs.readFileSync("users.txt", "utf8");
                console.log(data);  // –≤—ã–≤–æ–¥–∏–º —Å—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            });
        }
    }
    // clearInterval(timeInterval);
}

bot.command('start', (ctx) => { //–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
    try{
        ctx.replyWithHTML(`–î–æ–±—Ä—ã–π –¥–µ–Ω—å, ${ctx.message.from.first_name ? ctx.message.from.first_name: '–Ω–µ–∑–Ω–∞–∫–æ–º–µ—Ü'}!` +
                " –ù–∞ —Å–≤—è–∑–∏ –ò—Ä–∏–Ω–∞ - –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞.  –û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –≤—ã –Ω–µ —Å—Ç–æ–∏—Ç–µ –Ω–∞ –º–µ—Å—Ç–µ, –∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—à –∞–Ω–≥–ª–∏–π—Å–∫–∏–πüëçüèª\n" +
                "\n" +
                "‚û°Ô∏è —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç ¬´–õ–µ—Ç–Ω–∏–π —á–µ–ª–ª–µ–Ω–¥–∂ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ¬ª, –≤—ã–±–µ—Ä–µ—Ç–µ –∫–æ–º–∞–Ω–¥—É ¬´–Ø —Ö–æ—á—É —á–µ–∫-–ª–∏—Å—Ç¬ª\n" +
                "\n" +
                "‚û°Ô∏è –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å, –≤—Å—Ç—É–ø–∞–π—Ç–µ –≤ –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª ‚ÄúI know this word!‚Äù –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –≤ –∫—Ä—É–≥—É –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤. –°–¢–ê–†–¢ 26 –ò–Æ–ù–Ø!\n\n" +
                "‚û°Ô∏è –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–æ–π <a href='https://t.me/irinayourteacher'>–∫–∞–Ω–∞–ª</a>, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤—Å—ë —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –∏ –ø–æ–ª–µ–∑–Ω–æ–µ –æ–± –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞" ,
                Markup.keyboard(['–Ø —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç', '–Ø —Ö–æ—á—É –ø–æ–ø–∞—Å—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º–º-–∫–∞–Ω–∞–ª']).resize());
            console.log(ctx.chat.id)
    }catch{
        console.error(e);
    }
});


bot.help((ctx) => ctx.reply(text.commands))
bot.launch();

bot.hears('–Ø —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç', async (ctx) => { //–æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫-–ª–∏—Å—Ç–∞
    try{
            await ctx.replyWithHTML("–í–∞—à —á–µ–∫-–ª–∏—Å—Ç. –ñ–µ–ª–∞—é –ø—Ä–æ–≤–µ—Å—Ç–∏ –ª–µ—Ç–æ —Å –ø–æ–ª—å–∑–æ–π!")
            if(src !== false){
                await ctx.replyWithDocument({
                    source: src
                })
            }
    }catch{
        console.error(e);
    }
})


bot.hears('–Ø —Ö–æ—á—É –ø–æ–ø–∞—Å—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º–º-–∫–∞–Ω–∞–ª', async (ctx) => { //–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–≥ –∫–∞–Ω–∞–ª
    try{
        await ctx.replyWithHTML("<b>–ü—Ä–µ–∂–¥–µ —á–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ —É—á–∞—Å—Ç–∏—è:</b>\n\n" +
                        "1. –î–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É –Ω–æ–≤–æ–π –ª–µ–∫—Å–∏–∫–∏. –ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –Ω–∞ –Ω–µ–¥–µ–ª—é, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—Ç –≤—ã—É—á–∏—Ç—å.\n\n" +
                        "2. –î–æ–ø—É—Å–∫–∞—é—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å —É—Ä–æ–≤–Ω–µ–º <b>–æ—Ç B1 –¥–æ –°1.</b>\n\n" +
                        "3. –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤–∞–º –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–æ —Å–ª–æ–≤–∞–º–∏ –∏–∑ –≤–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞ (3 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤–∞ = 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è). –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ –ø—è—Ç–Ω–∏—Ü—É. –° —Å—É–±–±–æ—Ç—ã –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ —É—á–∞—Å—Ç–Ω–∏–∫ –ø–∏—à–µ—Ç —Å–≤—è–∑–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é —Å–æ —Å–ª–æ–≤–∞–º–∏ –Ω–µ–¥–µ–ª–∏.\n\n" +
                        "–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ <a href='https://drive.google.com/file/d/1y2zV3lb2QIJ9wwy83T52yYmuoiCb25US/view?usp=sharing'>—Å—Å—ã–ª–∫–µ</a>.",
                        Markup.keyboard(['–Ø —Å–æ–≥–ª–∞—Å–µ–Ω']).resize());

    }catch{
        console.error(e);
    }
})

bot.hears('–Ø —Å–æ–≥–ª–∞—Å–µ–Ω', async (ctx) => { //–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ —É—Ä–æ–≤–µ–Ω—å
    try{
        await ctx.reply("–£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å —è–∑—ã–∫–∞. –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è: https://www.efset.org/quick-check/",
                    Markup.keyboard([['B1', 'B2', 'C1']]).resize());
    
    }catch{
        console.error(e);
    }
})

function getLevel(level){ //–ø–æ–ª—É—á–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∏ –æ—Ç—Å—ã–ª–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω—É
    bot.hears(level, async (ctx) => {
        levelAnswer = level;
        try{
            await ctx.reply("–°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∏—è:\n" +
                            "1 –Ω–µ–¥–µ–ª—è - 250 —Ä—É–±–ª–µ–π;\n\n" +
                            "–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ –æ—Ç 2-—Ö –Ω–µ–¥–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–∫–∏–¥–∫–∞ (—Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –Ω–µ–¥–µ–ª–∏ - 200 —Ä—É–±–ª–µ–π) ‚¨áÔ∏è\n" +
                            "2 –Ω–µ–¥–µ–ª–∏ - 400 —Ä—É–±–ª–µ–π;\n" +
                            "3 –Ω–µ–¥–µ–ª–∏ - 600 —Ä—É–±–ª–µ–π;\n" +
                            "–ú–µ—Å—è—Ü - 800 —Ä—É–±–ª–µ–π.",
                    Markup.keyboard([['1 –Ω–µ–¥–µ–ª—è', '2 –Ω–µ–¥–µ–ª–∏', '3 –Ω–µ–¥–µ–ª–∏'], ['–ú–µ—Å—è—Ü']]).resize());
        }catch{
            console.error(e);
        }
    })
}
getLevel('B1');
getLevel('B2');
getLevel('C1');
console.log(levelAnswer + "---")

const getInvoice = (id, price) => {
    const invoice = {
      chat_id: id, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–µ–ª–µ–≤–æ–≥–æ —á–∞—Ç–∞ –∏–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
      provider_token: providerToken, // —Ç–æ–∫–µ–Ω –≤—ã–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ –±–æ—Ç @SberbankPaymentBot 
      start_parameter: 'get_access', //–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≥–ª—É–±–∏–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫. –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª, –ø–æ–∑–≤–æ–ª—è—é—â—É—é –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å—á–µ—Ç. –ï—Å–ª–∏ –Ω–µ –ø—É—Å—Ç–æ, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫—É URL —Å –≥–ª—É–±–æ–∫–æ–π —Å—Å—ã–ª–∫–æ–π –Ω–∞ –±–æ—Ç–∞ (–≤–º–µ—Å—Ç–æ –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã) —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
      title: '–û–ø–ª–∞—Ç–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ', // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, 1-32 —Å–∏–º–≤–æ–ª–∞
      description: '–†–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É —è–∑—ã–∫—É', // –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, 1-255 –∑–Ω–∞–∫–æ–≤
      currency: 'RUB', // –¢—Ä–µ—Ö–±—É–∫–≤–µ–Ω–Ω—ã–π –∫–æ–¥ –≤–∞–ª—é—Ç—ã ISO 4217
      prices: [{ label: '–û–ø–ª–∞—Ç–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ', amount: 100 * price }], // –†–∞–∑–±–∏–≤–∫–∞ —Ü–µ–Ω, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON 100 –∫–æ–ø–µ–µ–∫ * 100 = 100 —Ä—É–±–ª–µ–π
      photo_url: '#', // URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Å—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —Ä–µ–∫–ª–∞–º–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥–∏. –õ—é–¥—è–º –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–Ω–∏ –≤–∏–¥—è—Ç, –∑–∞ —á—Ç–æ –ø–ª–∞—Ç—è—Ç.
      photo_width: 500, // –®–∏—Ä–∏–Ω–∞ —Ñ–æ—Ç–æ
      photo_height: 281, // –î–ª–∏–Ω–∞ —Ñ–æ—Ç–æ
      payload: { // –ü–æ–ª–µ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±–æ—Ç–æ–º, 1‚Äì128 –±–∞–π—Ç. –≠—Ç–æ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è —Å–≤–æ–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
        unique_id: `${id}_${Number(new Date())}`,
        provider_token: providerToken 
      }
    }
  
    return invoice
  }

function checkHavePay(chatid){
    let read = fs.readFileSync("users.txt", "utf-8").toString().split('\n');
    for(let i = 0; i < read.length; i++){
        let string = read[i].split(' --- ');
        if(string[1] == chatid){
            return true;
        }
    }
    return false;
}
bot.hears('1 –Ω–µ–¥–µ–ª—è', (ctx) => {  // —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ - "pay"
  countDays = 7;
  if(checkHavePay(ctx.message.from.id)){
    return ctx.reply("–í—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏")
  }
  return ctx.replyWithInvoice(getInvoice(ctx.from.id, 250)) //  –º–µ—Ç–æ–¥ replyWithInvoice –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞
})
bot.hears('2 –Ω–µ–¥–µ–ª–∏', (ctx) => {  // —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ - "pay"
    if(checkHavePay(ctx.message.from.id)){
        return ctx.reply("–í—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏")
    }
    countDays = 14;
    return ctx.replyWithInvoice(getInvoice(ctx.from.id, 400)) //  –º–µ—Ç–æ–¥ replyWithInvoice –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞  
})
bot.hears('3 –Ω–µ–¥–µ–ª–∏', (ctx) => {  // —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ - "pay"
    if(checkHavePay(ctx.message.from.id)){
        return ctx.reply("–í—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏")
    }
    countDays = 21;
    return ctx.replyWithInvoice(getInvoice(ctx.from.id, 600)) //  –º–µ—Ç–æ–¥ replyWithInvoice –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞  
})
bot.hears('–ú–µ—Å—è—Ü', (ctx) => {  // —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ - "pay"
    if(checkHavePay(ctx.message.from.id)){
        return ctx.reply("–í—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏")
    }
    countDays = 31;
    return ctx.replyWithInvoice(getInvoice(ctx.from.id, 800)) //  –º–µ—Ç–æ–¥ replyWithInvoice –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞  
})

bot.on('pre_checkout_query', (ctx) => ctx.answerPreCheckoutQuery(true)) // –æ—Ç–≤–µ—Ç –Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ –æ–ø–ª–∞—Ç–µ

bot.on('successful_payment', async (ctx, next) => { // –æ—Ç–≤–µ—Ç –≤ —Å–ª—É—á–∞–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã
  await ctx.reply('–í—Å—Ç—É–ø–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É –ø–æ —Å—Å—ã–ª–∫–µ: https://t.me/+xddYRRpV3KYxZjli\n' +
                  '–ì–æ—Ç–æ–≤—ã–µ —Å–ø–∏—Å–∫–∏ —Å–ª–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º‚¨áÔ∏è\n\n',
  Markup.keyboard(['–Ø —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç', '–Ø —Ö–æ—á—É –ø–æ–ø–∞—Å—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º–º-–∫–∞–Ω–∞–ª']).resize());
  if(b1 !== false){
    await ctx.replyWithDocument({
        source: b1
    })
  }
  if(b2 !== false){
    await ctx.replyWithDocument({
        source: b2
    })
  }
  if(c1 !== false){
    await ctx.replyWithDocument({
        source: c1
    })
  }
  let date = new Date();
  fs.appendFile("users.txt", `${ctx.message.from.username} --- ${ctx.chat.id} --- ${new Date(date.setDate(date.getDate() + countDays + 1)).toLocaleDateString()} --- ${ctx.message.from.first_name ? ctx.message.from.first_name: '–±–µ–∑ –∏–º–µ–Ω–∏'} ${ctx.message.from.last_name ? ctx.message.from.last_name: '–±–µ–∑ —Ñ–∞–º–∏–ª–∏–∏'}\n`, function(error){
    if(error) throw error; // –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞             
    console.log("–ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:");
    let data = fs.readFileSync("users.txt", "utf8");
    console.log(data);  // –≤—ã–≤–æ–¥–∏–º —Å—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  });
  console.log(levelAnswer)
  bot.telegram.sendMessage(chatId, 
    `–ü—Ä–∏–≤–µ—Ç, –ò—Ä–∏–Ω–∞!\n` + 
    `–£ –Ω–∞—Å —Å –≤–∞–º–∏ –Ω–æ–≤—ã–π —É—á–µ–Ω–∏–∫: ${ctx.message.from.first_name ? ctx.message.from.first_name: '–±–µ–∑ –∏–º–µ–Ω–∏'} ${ctx.message.from.last_name ? ctx.message.from.last_name: '–±–µ–∑ —Ñ–∞–º–∏–ª–∏–∏'}\n` +
    `–£—Ä–æ–≤–µ–Ω—å: ${levelAnswer}\n` +
    `–ï–≥–æ –Ω–∏–∫ –≤ —Ç–≥: @${ctx.message.from.username}\n` +
    `–ï–≥–æ –ø–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è –¥–æ: ${new Date(date.setDate(date.getDate())).toLocaleDateString()} (–Ω–µ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)`);
})


bot.use(async (ctx) => { //–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –±–æ—Ç –Ω–µ –∑–Ω–∞–µ—Ç
    try{
        await ctx.reply('–ß—Ç–æ-—Ç–æ —è –∑–∞–ø—è–º—è—Ç–æ–≤–∞–ª, –Ω–µ –ø—Ä–∏–ø–æ–º–Ω—é —Ç–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã...');
        await ctx.reply('–ü–æ—ç—Ç–æ–º—É –ø–æ–ø—Ä–æ–±—É–π –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞, –Ω–µ —Å–æ–≤–µ—Ä—à–∞–π –±–æ–ª—å—à–µ —Ç–∞–∫–∏—Ö –æ—à–∏–±–æ–∫!',
              Markup.keyboard(['–Ø —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç', '–Ø —Ö–æ—á—É –ø–æ–ø–∞—Å—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º–º-–∫–∞–Ω–∞–ª']).resize());
    }catch{
        console.error(e);
    }
})


// Enable graceful stop
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));